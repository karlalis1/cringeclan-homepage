<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CringeClan - Exklusiv-Blog</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary: #8ab4f8;
            --background: #202124;
            --card-bg: #303134;
            --text: #e8eaed;
            --border: #5f6368;
            --admin-accent: #fbbc04;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--background);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid var(--border);
        }
        
        .hidden {
            display: none;
        }
        
        #admin-panel {
            border: 2px solid var(--admin-accent);
        }
        
        .admin-only {
            background: rgba(251, 188, 4, 0.1);
            padding: 15px;
            border-left: 3px solid var(--admin-accent);
            margin: 15px 0;
        }
        
        button, textarea {
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 4px;
        }
        
        button:hover {
            background: var(--primary);
            color: #202124;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
        }
        
        #blog-content {
            padding: 15px;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Anmeldebereich -->
        <div id="auth-section" class="card">
            <h1>CringeClan Exklusiv-Blog</h1>
            <div id="g_id_onload"
                 data-client_id="302339910588-46kgmvp20bo9buje51kerr6f6oqbbobc.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="handleGoogleSignIn"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="dark"
                 data-text="signin_with"
                 data-size="large"
                 data-logo_alignment="left">
            </div>
        </div>
        
        <!-- Hauptinhalt (nach Anmeldung) -->
        <div id="content-section" class="hidden">
            <div class="card">
                <h2>Willkommen, <span id="user-name"></span>!</h2>
                <button id="signout-btn">Abmelden</button>
            </div>
            
            <!-- Blog-Inhalt fÃ¼r alle Whitelist-Mitglieder -->
            <div class="card">
                <h3>Exklusive Clan-Updates</h3>
                <div id="blog-content">
                    Lade Inhalte...
                </div>
            </div>
            
            <!-- Nur fÃ¼r Admin sichtbar -->
            <div id="admin-panel" class="card hidden">
                <h3><span style="color:var(--admin-accent)">ðŸ”§ ADMIN-BEREICH</span></h3>
                <div class="admin-only">
                    <h4>Blog bearbeiten:</h4>
                    <textarea id="blog-editor"></textarea>
                    <button id="save-blog">Speichern</button>
                    <p id="save-status"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Konfiguration
        const ADMIN_EMAIL = "cringealiyt@gmail.com";
        const BLOG_STORAGE_KEY = "cringeclan_blog_content";
        const WHITELIST_STORAGE_KEY = "cringeclan_whitelist";
        
        // Initialer Blog-Inhalt
        const DEFAULT_BLOG_CONTENT = `
            <h4>DJ-Karriere Update</h4>
            <p>"Ich starte meine Karriere als DJ... (absolute Katastrophe)"</p>
            <p>Letzte Woche habe ich aus Versehen den Hauptstrom abgeschaltet. Nicht mein stolzester Moment.</p>
        `;
        
        // Initiale Whitelist
        const DEFAULT_WHITELIST = [ADMIN_EMAIL];

        // Google Sign-In Handler
        function handleGoogleSignIn(response) {
            const userData = decodeJWT(response.credential);
            const userEmail = userData.email;
            
            document.getElementById("user-name").textContent = userData.name;
            document.getElementById("user-email").textContent = userEmail;
            
            // Whitelist prÃ¼fen
            const whitelist = getWhitelist();
            if (!whitelist.includes(userEmail)) {
                alert("Zugriff verweigert: Deine E-Mail ist nicht in der Whitelist");
                return;
            }
            
            // Anzeigen
            document.getElementById("auth-section").classList.add("hidden");
            document.getElementById("content-section").classList.remove("hidden");
            
            // Admin-Check
            if (userEmail === ADMIN_EMAIL) {
                document.getElementById("admin-panel").classList.remove("hidden");
                loadBlogEditor();
            }
            
            loadBlogContent();
        }
        
        // Blog laden
        function loadBlogContent() {
            const savedContent = localStorage.getItem(BLOG_STORAGE_KEY) || DEFAULT_BLOG_CONTENT;
            document.getElementById("blog-content").innerHTML = savedContent;
        }
        
        // Editor laden (nur fÃ¼r Admin)
        function loadBlogEditor() {
            const savedContent = localStorage.getItem(BLOG_STORAGE_KEY) || DEFAULT_BLOG_CONTENT;
            document.getElementById("blog-editor").value = savedContent
                .replace(/<br\s*\/?>/gi, "\n")
                .replace(/<[^>]*>/g, "");
        }
        
        // Whitelist aus Storage holen
        function getWhitelist() {
            const stored = localStorage.getItem(WHITELIST_STORAGE_KEY);
            return stored ? JSON.parse(stored) : DEFAULT_WHITELIST;
        }
        
        // Blog speichern (nur Admin)
        document.getElementById("save-blog").addEventListener("click", () => {
            const content = document.getElementById("blog-editor").value;
            localStorage.setItem(BLOG_STORAGE_KEY, formatAsHtml(content));
            document.getElementById("save-status").textContent = "Gespeichert!";
            loadBlogContent();
            setTimeout(() => document.getElementById("save-status").textContent = "", 2000);
        });
        
        // Helper: Text zu HTML formatieren
        function formatAsHtml(text) {
            return text.split('\n').map(paragraph => {
                if (paragraph.trim() === '') return '<br>';
                return `<p>${paragraph}</p>`;
            }).join('');
        }
        
        // Helper: JWT decodieren
        function decodeJWT(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => 
                '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
            return JSON.parse(jsonPayload);
        }
        
        // Abmelden
        document.getElementById("signout-btn").addEventListener("click", () => {
            document.getElementById("auth-section").classList.remove("hidden");
            document.getElementById("content-section").classList.add("hidden");
        });
    </script>
</body>
</html>