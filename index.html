<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CringeClan - Admin Dashboard</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary: #8ab4f8;
            --background: #202124;
            --card-bg: #303134;
            --text: #e8eaed;
            --border: #5f6368;
            --admin-accent: #fbbc04;
            --success: #81c995;
            --error: #f28b82;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--background);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid var(--border);
        }
        
        .hidden {
            display: none;
        }
        
        #admin-panel {
            border: 2px solid var(--admin-accent);
        }
        
        .admin-section {
            background: rgba(251, 188, 4, 0.1);
            padding: 15px;
            border-left: 3px solid var(--admin-accent);
            margin: 15px 0;
        }
        
        button, input, textarea {
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 4px;
        }
        
        button {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        button:hover {
            background: var(--primary);
            color: #202124;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
        }
        
        #whitelist-list {
            margin: 10px 0;
            padding: 0;
            list-style-type: none;
        }
        
        #whitelist-list li {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }
        
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background-color: var(--success);
            color: #202124;
        }
        
        .error {
            background-color: var(--error);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Anmeldebereich -->
        <div id="auth-section" class="card">
            <h1>CringeClan Exklusivbereich</h1>
            <div id="g_id_onload"
                 data-client_id="302339910588-46kgmvp20bo9buje51kerr6f6oqbbobc.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="handleGoogleSignIn"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="dark"
                 data-text="signin_with"
                 data-size="large"
                 data-logo_alignment="left">
            </div>
        </div>
        
        <!-- Hauptinhalt (nach Anmeldung) -->
        <div id="content-section" class="hidden">
            <div class="card">
                <h2>Willkommen, <span id="user-name"></span>!</h2>
                <p>E-Mail: <span id="user-email"></span></p>
                <button id="signout-btn">Abmelden</button>
            </div>
            
            <!-- Blog-Inhalt f√ºr alle -->
            <div class="card">
                <h3>Clan News</h3>
                <div id="blog-content">
                    Lade Inhalte...
                </div>
            </div>
            
            <!-- Nur f√ºr Admin sichtbar -->
            <div id="admin-panel" class="card hidden">
                <h3><span style="color:var(--admin-accent)">üîß ADMIN-BEREICH</span></h3>
                
                <div class="admin-section">
                    <h4>Blog bearbeiten:</h4>
                    <textarea id="blog-editor"></textarea>
                    <button id="save-blog">Speichern</button>
                    <div id="blog-status" class="status-message hidden"></div>
                </div>
                
                <div class="admin-section">
                    <h4>Whitelist verwalten:</h4>
                    <input type="email" id="new-email" placeholder="Neue E-Mail hinzuf√ºgen">
                    <button id="add-email">Hinzuf√ºgen</button>
                    <div id="whitelist-status" class="status-message hidden"></div>
                    
                    <h5>Aktuelle Whitelist:</h5>
                    <ul id="whitelist-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Konfiguration
        const ADMIN_EMAIL = "cringealiyt@gmail.com";
        const BLOG_STORAGE_KEY = "cringeclan_blog_content";
        const WHITELIST_STORAGE_KEY = "cringeclan_whitelist";
        
        // Initialer Blog-Inhalt
        const DEFAULT_BLOG_CONTENT = `
            <h4>DJ-Karriere Update</h4>
            <p>"Ich starte meine Karriere als DJ... (absolute Katastrophe)"</p>
            <p>Letzte Woche habe ich aus Versehen den Hauptstrom abgeschaltet. Nicht mein stolzester Moment.</p>
        `;
        
        // Initiale Whitelist
        const DEFAULT_WHITELIST = [ADMIN_EMAIL];

        // Google Sign-In Handler
        function handleGoogleSignIn(response) {
            const userData = decodeJWT(response.credential);
            const userEmail = userData.email;
            
            document.getElementById("user-name").textContent = userData.name;
            document.getElementById("user-email").textContent = userEmail;
            
            // Whitelist pr√ºfen
            const whitelist = getWhitelist();
            if (!whitelist.includes(userEmail)) {
                alert("Zugriff verweigert: Deine E-Mail ist nicht in der Whitelist");
                return;
            }
            
            // Anzeigen
            document.getElementById("auth-section").classList.add("hidden");
            document.getElementById("content-section").classList.remove("hidden");
            
            // Nur Admin sieht Admin-Panel
            if (userEmail === ADMIN_EMAIL) {
                document.getElementById("admin-panel").classList.remove("hidden");
                loadBlogEditor();
                loadWhitelist();
            }
            
            loadBlogContent();
        }
        
        // Blog laden
        function loadBlogContent() {
            const savedContent = localStorage.getItem(BLOG_STORAGE_KEY) || DEFAULT_BLOG_CONTENT;
            document.getElementById("blog-content").innerHTML = savedContent;
        }
        
        // Editor laden (nur f√ºr Admin)
        function loadBlogEditor() {
            const savedContent = localStorage.getItem(BLOG_STORAGE_KEY) || DEFAULT_BLOG_CONTENT;
            document.getElementById("blog-editor").value = savedContent
                .replace(/<br\s*\/?>/gi, "\n")
                .replace(/<[^>]*>/g, "");
        }
        
        // Whitelist laden (nur f√ºr Admin)
        function loadWhitelist() {
            const whitelist = getWhitelist();
            const listElement = document.getElementById("whitelist-list");
            listElement.innerHTML = "";
            
            whitelist.forEach(email => {
                const li = document.createElement("li");
                li.innerHTML = `
                    ${email}
                    ${email !== ADMIN_EMAIL ? `<button class="remove-email" data-email="${email}">Entfernen</button>` : ''}
                `;
                listElement.appendChild(li);
            });
            
            // Event Listener f√ºr Remove-Buttons
            document.querySelectorAll(".remove-email").forEach(button => {
                button.addEventListener("click", function() {
                    removeFromWhitelist(this.getAttribute("data-email"));
                });
            });
        }
        
        // Whitelist aus Storage holen
        function getWhitelist() {
            const stored = localStorage.getItem(WHITELIST_STORAGE_KEY);
            return stored ? JSON.parse(stored) : DEFAULT_WHITELIST;
        }
        
        // Zur Whitelist hinzuf√ºgen (nur Admin)
        function addToWhitelist(email) {
            if (!validateEmail(email)) {
                showStatus("whitelist-status", "Ung√ºltige E-Mail-Adresse", "error");
                return;
            }
            
            const whitelist = getWhitelist();
            if (whitelist.includes(email)) {
                showStatus("whitelist-status", "E-Mail ist bereits in der Whitelist", "error");
                return;
            }
            
            whitelist.push(email);
            localStorage.setItem(WHITELIST_STORAGE_KEY, JSON.stringify(whitelist));
            loadWhitelist();
            document.getElementById("new-email").value = "";
            showStatus("whitelist-status", `${email} wurde zur Whitelist hinzugef√ºgt`, "success");
        }
        
        // Von Whitelist entfernen (nur Admin, nicht f√ºr eigene E-Mail)
        function removeFromWhitelist(email) {
            if (email === ADMIN_EMAIL) return;
            
            const whitelist = getWhitelist();
            const updated = whitelist.filter(e => e !== email);
            localStorage.setItem(WHITELIST_STORAGE_KEY, JSON.stringify(updated));
            loadWhitelist();
            showStatus("whitelist-status", `${email} wurde entfernt`, "success");
        }
        
        // Blog speichern (nur Admin)
        function saveBlog() {
            const content = document.getElementById("blog-editor").value;
            localStorage.setItem(BLOG_STORAGE_KEY, formatAsHtml(content));
            loadBlogContent();
            showStatus("blog-status", "Blog erfolgreich aktualisiert!", "success");
        }
        
        // Helper: E-Mail validieren
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        // Helper: Statusmeldung anzeigen
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status-message ${type}`;
            element.classList.remove("hidden");
            setTimeout(() => element.classList.add("hidden"), 3000);
        }
        
        // Helper: Text zu HTML formatieren
        function formatAsHtml(text) {
            return text.split('\n').map(paragraph => {
                if (paragraph.trim() === '') return '<br>';
                return `<p>${paragraph}</p>`;
            }).join('');
        }
        
        // Helper: JWT decodieren
        function decodeJWT(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => 
                '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
            return JSON.parse(jsonPayload);
        }
        
        // Event Listener
        document.getElementById("save-blog").addEventListener("click", saveBlog);
        document.getElementById("add-email").addEventListener("click", () => {
            addToWhitelist(document.getElementById("new-email").value.trim());
        });
        
        // Enter-Taste f√ºr E-Mail-Eingabe
        document.getElementById("new-email").addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                addToWhitelist(e.target.value.trim());
            }
        });
        
        // Abmelden
        document.getElementById("signout-btn").addEventListener("click", () => {
            document.getElementById("auth-section").classList.remove("hidden");
            document.getElementById("content-section").classList.add("hidden");
        });
    </script>
</body>
</html>